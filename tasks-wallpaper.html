<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
<title>Daily Planner ‚Üí PNG</title>
<style>
  :root{
    --bg:#ffffff; --fg:#0b0b0b; --muted:#8b8f98; --ring:#e9eaee;
    --card:#f8f9fb; --blue:#2563eb; --blue2:#00c2ff;
  }
  [data-theme="dark"]{
    --bg:#0c0d12; --fg:#f3f5f7; --muted:#a0a7b5; --ring:#191b22; --card:#11131a;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
    font-family: ui-sans-serif, -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial}
  .app{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}

  /* Header */
  header{
    position:sticky;top:0;z-index:5;padding:12px 14px calc(8px + env(safe-area-inset-top));
    display:flex;align-items:center;justify-content:space-between;gap:10px;
    background:linear-gradient(180deg,rgba(0,0,0,.03),transparent);
    border-bottom:1px solid var(--ring)
  }
  .brand{font-weight:900;letter-spacing:.2px}
  .chip{font-size:12px;color:var(--muted);padding:6px 10px;border:1px solid var(--ring);border-radius:999px}

  /* Panels */
  main{padding:14px;display:grid;gap:12px}
  .panel{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:12px;display:grid;gap:10px}

  /* Inputs row ‚Äì no overlap */
  .inputs{
    display:grid;gap:8px;
    grid-template-columns: 110px 110px 1fr 120px;
    align-items:center;
  }
  .inputs input[type="time"], .inputs input[type="text"]{
    width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--ring);background:var(--bg);color:var(--fg);outline:none
  }
  .add-btn{
    border:1px solid var(--ring);border-radius:12px;padding:10px 14px;font-weight:800;background:var(--bg);color:var(--fg);cursor:pointer
  }
  @media (max-width: 560px){
    .inputs{ grid-template-columns: 1fr 1fr; }
    .inputs input[type="text"]{ grid-column: 1 / -1; }
    .add-btn{ grid-column: 1 / -1; }
  }

  /* Templates */
  .templates{display:flex;gap:8px;flex-wrap:wrap}
  .tpl{padding:8px 12px;border-radius:999px;border:1px dashed var(--ring);background:transparent;color:var(--muted);font-weight:800;cursor:pointer}
  .tpl:hover{border-style:solid;color:var(--fg)}

  /* List */
  .list{display:grid;gap:8px}
  .item{display:grid;grid-template-columns: 120px 1fr auto;gap:10px;align-items:center;
        background:var(--bg);border:1px solid var(--ring);border-radius:12px;padding:10px}
  .time{font-weight:900;letter-spacing:.2px}
  .txt{opacity:.95}
  .actions{display:flex;gap:6px}
  .btn{padding:8px 10px;border:1px solid var(--ring);border-radius:10px;background:var(--bg);color:var(--fg);font-weight:700;cursor:pointer}
  .btn.blue{
    border:none;color:#fff;background:linear-gradient(135deg,var(--blue),var(--blue2));
    box-shadow:0 6px 18px rgba(37,99,235,.25)
  }

  /* Bottom bar */
  footer{
    position:sticky;bottom:0;z-index:5;padding:10px 14px calc(10px + env(safe-area-inset-bottom));
    display:flex;gap:8px;flex-wrap:wrap;justify-content:space-between;align-items:center;
    border-top:1px solid var(--ring);background:linear-gradient(0deg,rgba(0,0,0,.03),transparent)
  }
  select, input[type="number"]{
    padding:10px;border-radius:10px;border:1px solid var(--ring);background:var(--bg);color:var(--fg)
  }
  .hidden{display:none !important}
</style>
</head>
<body data-theme="light">
<div class="app">
  <header>
    <div style="display:flex;align-items:center;gap:10px">
      <div class="brand">Daily Planner</div>
      <div class="chip" id="msg">P≈ôipraveno</div>
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn" id="themeBtn">üåì T√©ma</button>
    </div>
  </header>

  <main>
    <!-- Quick add -->
    <section class="panel">
      <div class="inputs">
        <input type="time" id="from" value="08:00" aria-label="Od">
        <input type="time" id="to" value="08:30" aria-label="Do">
        <input type="text" id="what" placeholder="Co (nap≈ô. Deep Work, Workout, Call‚Ä¶)" aria-label="Co">
        <button class="add-btn" id="addBtn">Ôºã P≈ôidat</button>
      </div>
      <div class="templates">
        <button class="tpl" data-tpl="workday">Pracovn√≠ den</button>
        <button class="tpl" data-tpl="maker">Maker r√°no</button>
        <button class="tpl" data-tpl="wellness">Wellness veƒçer</button>
        <button class="tpl" data-tpl="clear">Vymazat pl√°n</button>
      </div>
    </section>

    <!-- Seznam blok≈Ø -->
    <section class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
        <div class="chip">Dne≈°n√≠ pl√°n</div>
        <div style="display:flex;gap:8px;align-items:center">
          <input type="date" id="dateInput"/>
          <button class="btn" id="sortBtn">‚Üï Se≈ôadit</button>
        </div>
      </div>
      <div class="list" id="list"></div>
    </section>
  </main>

  <footer>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <label>Telefon</label>
      <select id="device">
        <option value="1290x2796">iPhone 15/14 Pro Max (1290√ó2796)</option>
        <option value="1179x2556">iPhone 15/14 Pro (1179√ó2556)</option>
        <option value="1284x2778">iPhone 12/13 Pro Max, 14+ (1284√ó2778)</option>
        <option value="1170x2532">iPhone 12/13/14/15 (1170√ó2532)</option>
        <option value="1080x2340">iPhone 12/13 mini / obecn√© (1080√ó2340)</option>
        <option value="custom">Vlastn√≠‚Ä¶</option>
      </select>
      <input id="w" class="hidden" type="number" min="640" step="1" placeholder="≈†√≠≈ôka (px)"/>
      <input id="h" class="hidden" type="number" min="1136" step="1" placeholder="V√Ω≈°ka (px)"/>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button class="btn blue" id="exportBtn">‚¨áÔ∏è Export PNG</button>
      <button class="btn" id="clearAllBtn">üßπ Vymazat v≈°e</button>
    </div>
  </footer>
</div>

<script>
(()=> {
  const el = id => document.getElementById(id);
  const msg = t => { el('msg').textContent = t; setTimeout(()=>el('msg').textContent='P≈ôipraveno', 1800); };
  const pad = n => String(n).padStart(2,'0');
  const toMin = hhmm => { const [h,m] = hhmm.split(':').map(Number); return h*60+m; };
  const toHHMM = m  => pad(Math.floor(m/60))+':'+pad(m%60);

  let items = []; // {id, from, to, what}

  // THEME
  let theme = (localStorage.getItem('dp.theme') || 'light');
  document.body.setAttribute('data-theme', theme);
  el('themeBtn').addEventListener('click', ()=>{
    theme = (theme==='dark') ? 'light' : 'dark';
    document.body.setAttribute('data-theme', theme);
    localStorage.setItem('dp.theme', theme);
  });

  // DATE
  el('dateInput').value = new Date().toISOString().slice(0,10);

  // ADD
  el('addBtn').addEventListener('click', ()=>{
    const f = el('from').value, t = el('to').value, w = el('what').value.trim();
    if(!f || !t || !w) return msg('Vypl≈à ƒças i text');
    if(toMin(t) <= toMin(f)) return msg('‚ÄûDo‚Äú mus√≠ b√Ωt pozdƒõji ne≈æ ‚ÄûOd‚Äú');
    items.push({ id: uid(), from: f, to: t, what: w });
    sortItems(); renderList(); el('what').value='';
  });

  // TEMPLATES
  document.querySelectorAll('.tpl').forEach(b=>{
    b.addEventListener('click', ()=>{
      const id = b.dataset.tpl;
      if(id==='clear'){ items=[]; renderList(); return; }
      items = template(id); sortItems(); renderList();
    });
  });

  // SORT
  el('sortBtn').addEventListener('click', ()=>{ sortItems(); renderList(); });

  // CLEAR ALL
  el('clearAllBtn').addEventListener('click', ()=>{
    if(confirm('Vymazat cel√Ω pl√°n?')){ items=[]; renderList(); }
  });

  // DEVICE select
  el('device').addEventListener('change', ()=>{
    const v = el('device').value;
    const custom = (v==='custom');
    el('w').classList.toggle('hidden', !custom);
    el('h').classList.toggle('hidden', !custom);
  });

  // EXPORT
  el('exportBtn').addEventListener('click', async ()=>{
    if(items.length===0){ msg('P≈ôidej aspo≈à jeden blok'); return; }
    const size = getSize();
    const blob = await renderPNG(size.w, size.h);
    const name = `daily_${el('dateInput').value}_${size.w}x${size.h}.png`;
    downloadBlob(blob, name);
    msg('Export hotov ‚úîÔ∏è');
  });

  // RENDER LIST
  function renderList(){
    const wrap = el('list'); wrap.innerHTML='';
    if(!items.length){
      wrap.innerHTML = `<div class="chip" style="border-style:dashed">≈Ω√°dn√© bloky. P≈ôidej naho≈ôe nebo pou≈æij ≈°ablonu.</div>`;
      return;
    }
    items.forEach(it=>{
      const row = document.createElement('div'); row.className='item';
      const time = document.createElement('div'); time.className='time'; time.textContent = `${it.from}‚Äì${it.to}`;
      const txt = document.createElement('div'); txt.className='txt'; txt.textContent = it.what;
      const actions = document.createElement('div'); actions.className='actions';
      const edit = button('‚úé', ()=>editItem(it.id));
      const del  = button('√ó', ()=>{ items = items.filter(x=>x.id!==it.id); renderList(); });
      actions.append(edit, del);
      row.append(time, txt, actions); wrap.appendChild(row);
    });
  }
  function button(label, on){ const b=document.createElement('button'); b.className='btn'; b.textContent=label; b.addEventListener('click', on); return b; }
  function editItem(id){
    const it = items.find(x=>x.id===id); if(!it) return;
    const f = prompt('Od (HH:MM):', it.from); if(!f) return;
    const t = prompt('Do (HH:MM):', it.to); if(!t) return;
    const w = prompt('Co:', it.what); if(!w) return;
    if(toMin(t) <= toMin(f)) return msg('‚ÄûDo‚Äú mus√≠ b√Ωt pozdƒõji ne≈æ ‚ÄûOd‚Äú');
    it.from=f; it.to=t; it.what=w.trim(); sortItems(); renderList();
  }
  function sortItems(){ items.sort((a,b)=> toMin(a.from) - toMin(b.from) || toMin(a.to)-toMin(b.to)); }
  function uid(){ return Math.random().toString(36).slice(2,9); }

  // PRESETS
  function template(id){
    const B=(f,t,w)=>({id:uid(),from:f,to:t,what:w});
    if(id==='workday') return [
      B('07:30','08:00','Rann√≠ rutina'),
      B('08:00','10:30','Deep Work blok'),
      B('10:30','11:00','E-maily & administrace'),
      B('11:00','12:00','Sch≈Øzky / Calls'),
      B('12:00','13:00','Obƒõd & proch√°zka'),
      B('13:00','15:00','Projekt A ‚Äî fokus'),
      B('15:00','15:30','K√°va & reset'),
      B('15:30','17:00','Projekt B ‚Äî dod√°vky'),
      B('17:30','18:30','Workout / bƒõh'),
      B('19:00','21:00','Volno / rodina / ƒçten√≠')
    ];
    if(id==='maker') return [
      B('06:30','07:15','Lehk√Ω streƒçink & pl√°n dne'),
      B('07:15','09:45','Tvorba / psan√≠ / k√≥d'),
      B('09:45','10:15','Pauza & e-maily'),
      B('10:15','12:00','Tvorba pokraƒçov√°n√≠')
    ];
    if(id==='wellness') return [
      B('18:00','18:45','Lehk√Ω tr√©nink'),
      B('18:45','19:15','Sprcha / veƒçe≈ôe'),
      B('19:30','20:00','Proch√°zka'),
      B('20:00','21:00','ƒåten√≠ / off-screen')
    ];
    return [];
  }

  // CANVAS RENDER ‚Äî left-aligned, vertically centered block
  async function renderPNG(W, H){
    // Colors
    const BG = (theme==='dark') ? '#0c0d12' : '#ffffff';
    const FG = (theme==='dark') ? '#f3f5f7' : '#0b0b0b';
    const MUTED = (theme==='dark') ? '#a0a7b5' : '#8b8f98';

    // Base sizes (will auto-scale if content is long)
    let titleSize = Math.round(W*0.085);
    let lineSize  = Math.round(W*0.038);
    let gap       = Math.round(W*0.018);
    let lineH     = Math.round(W*0.048);
    const PAD_L   = Math.round(W*0.07);      // left offset
    const PAD_R   = Math.round(W*0.06);      // right padding

    const cvs = document.createElement('canvas'); cvs.width=W; cvs.height=H;
    const ctx = cvs.getContext('2d');

    // Measure total height to center vertically
    function measureTotal(){
      ctx.font = `900 ${titleSize}px Inter, -apple-system, Segoe UI, Roboto, Arial`;
      const hTitle = titleSize;
      ctx.font = `500 ${Math.round(W*0.03)}px Inter, -apple-system, Segoe UI, Roboto, Arial`;
      const hDate = Math.round(W*0.05);
      const linesH = items.length * lineH + Math.max(0, items.length-1) * (gap - (lineH - lineSize)); // visual spacing
      return hTitle + Math.round(W*0.02) + hDate + Math.round(W*0.04) + linesH;
    }

    // If overflow, scale down
    let total = measureTotal();
    if(total > H * 0.88){
      const s = (H*0.88) / total;
      titleSize = Math.max(28, Math.floor(titleSize*s));
      lineSize  = Math.max(16, Math.floor(lineSize*s));
      lineH     = Math.max(lineSize+6, Math.floor(lineH*s));
      gap       = Math.floor(gap*s);
      total     = measureTotal();
    }

    // Draw background
    ctx.fillStyle = BG; ctx.fillRect(0,0,W,H);

    // Start Y to vertical center
    let Y = Math.round((H - total)/2);

    // Title
    ctx.fillStyle = FG;
    ctx.font = `900 ${titleSize}px Inter, -apple-system, Segoe UI, Roboto, Arial`;
    ctx.textBaseline = 'top';
    ctx.fillText('DAILY PLAN', PAD_L, Y);
    Y += titleSize + Math.round(W*0.02);

    // Date
    ctx.fillStyle = MUTED;
    ctx.font = `500 ${Math.round(W*0.03)}px Inter, -apple-system, Segoe UI, Roboto, Arial`;
    const dateText = formatCzechDate(new Date(el('dateInput').value));
    ctx.fillText(dateText, PAD_L, Y);
    Y += Math.round(W*0.04);

    // Lines (one line: "HH:MM‚ÄìHH:MM  text")
    const maxLineWidth = W - PAD_L - PAD_R;
    ctx.fillStyle = FG;
    ctx.font = `600 ${lineSize}px Inter, -apple-system, Segoe UI, Roboto, Arial`;

    items.forEach(it=>{
      const line = `${it.from}‚Äì${it.to}  ${it.what}`;
      const final = ellipsize(ctx, line, maxLineWidth);
      ctx.fillText(final, PAD_L, Y);
      Y += lineH;
    });

    return await new Promise(res => cvs.toBlob(res, 'image/png', 1));
  }

  // Utilities
  function ellipsize(ctx, text, maxW){
    if(ctx.measureText(text).width <= maxW) return text;
    let lo = 0, hi = text.length, mid, fit = '‚Ä¶';
    while(lo <= hi){
      mid = (lo+hi)>>1;
      const test = text.slice(0, mid) + '‚Ä¶';
      if(ctx.measureText(test).width <= maxW){ fit = test; lo = mid+1; } else hi = mid-1;
    }
    return fit;
  }
  function getSize(){
    const v = el('device').value;
    if(v==='custom'){
      const w = Math.max(640, +el('w').value||1290);
      const h = Math.max(1136, +el('h').value||2796);
      return { w, h };
    }
    const [w,h] = v.split('x').map(Number);
    return { w, h };
  }
  function downloadBlob(blob, filename){
    const a=document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a); a.click();
    setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); },0);
  }
  function formatCzechDate(d){
    const WD=['Nedƒõle','Pondƒõl√≠','√öter√Ω','St≈ôeda','ƒåtvrtek','P√°tek','Sobota'][d.getDay()];
    const M=['ledna','√∫nora','b≈ôezna','dubna','kvƒõtna','ƒçervna','ƒçervence','srpna','z√°≈ô√≠','≈ô√≠jna','listopadu','prosince'][d.getMonth()];
    return `${WD}, ${d.getDate()}. ${M}`;
  }
})();
</script>
</body>
</html>
